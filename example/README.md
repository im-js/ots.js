# 消息存储示例设计
## 原则
1. 分区键的取值要足够的离散，以确保没有热点分区；
2. 选择合理的分区键，使得并发写的聚集效果更好，减少 `BatchWrite` 操作的数据分散度。

## 场景
数据需求:  
1. 用户通过 userId 拉取自身相关所有会话。
2. 用户通过 自身ID + 对方ID 拉取会话
3. 用户拉取相关群会话

统计需求：  
1. 统计用户消息未读数、点击数等，并可更改阅读、点击状态。

存储思路：
1. 私聊的用户状态和数据都以 userId 为分区键
2. 群聊的用户状态和数据都以 groupId 为分区键

## 群消息存储
```javascript
pk: {
    pk: md5(groupId) // 分区键
    
}
```

## 私聊消息存储
```javascript
pk: {
    pk: md5(userId) // 分区键
}
```

## 参考
1. [表格存储服务在社交应用场景的实践](https://yq.aliyun.com/articles/57252)